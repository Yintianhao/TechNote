## 对象内存模型          
### 对象头        
第一部分：存储对象自身运行时数据：hashCode，GC分代年龄，锁状态标志，线程持有的锁，偏向锁ID，偏向时间戳。          
第二部分：类型指针，指向对象所属类元数据的指针，用来判断对象属于哪个类的实例。指向方法区。         
### 实例数据          
对象真正有效的信息，如成员变量的值             
### 对齐补充          
Hotspot虚拟机要求对对象本身大小必须是8的整数倍，对象头一定是八字节，但是因为实例数据是任意的，所以需要补齐。        
## 对象创建步骤        
1，类加载检查，遇到new指令时候，先检查指令参数是否可以在常量池中定位到类的符号引用，并检查该符号引用代表的类是否加载，解析，初始化过，若没有，则执行类加载。        
2，类加载检查通过后，接下来虚拟机将为新生对象分配内存，对象所需的内存大小在类加载完成之后便可确定，为对象分配空间的任务等同于把一块确定大小的内存从java堆中划分出来。

```
虚拟机通过两种方式来保证线程安全：
1，CAS+失败重试，CAS是一种乐观锁的实现方式，每次不加锁而是假设没有冲突去完成操作，如果冲突失败就重试，直到成功为止，虚拟机采用CAS配上失败重试的方式来保证更新操作的原子性。
2，TLAB，为每一个线程预先在eden区分配一块内存，jvm在给线程的对象分配内存的时候，首先在TLAB分配，当对象大于TLAB剩余内存的时候，再采用CAS+ 重试
```

3，初始化零值

4，必要的对象头设置

5，调用类构造器进行对象初始化。

## 访问对象的两种方式         
### 句柄：       
栈中存放句柄的地址，即引用，堆中划分出句柄池，句柄中包含实例的数据指针（指向堆），对象类型数据指针（方法区）；
优点：GC算法执行时，虽然对象移动但是句柄会跟着变化，而引用持有的是句柄的地址，稳定不变。       
### 直接指针访问        
引用直接存放对象地址，没有句柄池，因此堆对象布局需要多考虑一个对象类型的指针的存储     
优点：二级寻址变为一级寻址，效率高           
