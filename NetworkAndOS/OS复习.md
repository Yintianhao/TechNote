## OS

### 什么是系统调用

- 用户态和系统态的区别

用户态运行的进程可以直接读取用户程序的数据，系统态也就是内核态可以简单的理解为内核态中运行的程序和程序几乎可以访问到计算机的任何资源，不受限制。

- 系统调用

我们运行的程序都在用户态，如果我们调用操作系统提供的内核态的子功能，就要用到系统调用了，也就是如果我们需要用到和内核态资源相关的操作，比如文件管理，进程控制，那么都必须通过系统调用方式来向操作系统发出服务请求然后由操作系统代为完成。

和系统调用设计的功能有：

```
1，设备管理
2，文件管理
3，进程控制
4，进程通信
5，内存管理
```



### 进程和线程的区别

线程是进程划分成的更小的运行单位，一个进程在其执行的过程中可以产生多个线程，线程和进程的最大的不同就是基本上各个进程是独立的，而各个线程却不一定，因为同一个进程中的线程可能会相互影响，线程开销小，当不利于资源的管理和保护，而进程开销大， 但是利于资源的管理和保护。

### 进程状态

1，创建状态，进程正在被创建，尚未到就绪状态

2，就绪状态，进程已经是准备运行的状态，即进程获得了除了处理器之外的一切所需资源，一旦得到处理器资源就可以运行。

3，运行状态，进程让那个正在处理器上运行，单核CPU任何一个时刻只会有一个进程处于运行状态。

4，阻塞状态，进程正在处理某一个事件的时候暂停运行，例如等待IO操作，此时即使处理器是空闲的，这个进程也不能运行。

5，结束状态，进程正在从系统中消失，可能是进程正常结束或者其他原因中断退出。

### 进程通信

1，管道/匿名管道，父子进程之间或者兄弟进程之间的通信

2，有名管道，遵循先进先出的原则，以磁盘文件的方式存在，可以实现本机中任意两个进程的通信。

3，信号，用于通知接收进程某一个事件已经发生。

4，消息队列，是一种消息的链表，具有特定的格式，存放在内存中并且有消息队列标识符标识，消息队列存放在内核中，只有在操作系统重启的时候或者显式地删除一个消息队列，消息队列才会被删除。

5，信号量，信号量实际上是一个计数器，用于多线程对共享数据的访问，信号量的意图在于进程间同步，这种通信方式主要解决与同步相关的问题并且避免竞争条件。

6，共享内存。

7，套接字，需要依靠网络，不多讲了。

### 线程间同步

1，互斥量。只有拥有互斥对象的线程才有访问公共资源的权限。

2，信号量，允许同一个时间多个线程访问同一个资源，但是需要控制同一个时刻访问这个资源的最大线程数量。

3，Event，通过通知来保持多线程同步。

### 进程调度

- 先到先服务，顾名思义，就绪队列中选最先进入队列的进程可以优先分配资源。
- 短作业优先，从就绪队列中选出估计运行时间最短的进程来分配资源。
- 时间片轮转，每个进程分配一个时间段，即称为他的时间片。
- 多级反馈队列调度算法，既能使得高优先级的作业得到响应，也能搞使得短作业迅速完成，是目前公认最好的一种调度算法。
- 优先级调度，顾名思义为每一个进程分配优先级，首先执行优先级最高的进程，相同优先级按照先进先出的原则来执行。

### 内存管理

操作系统的内存管理主要是负责内存的分配和回收，另外地址转换也是将其逻辑地址转换为响应的物理地址等功能也是内存管理做的事情。

#### 内存管理机制

1，块式管理，将内存分为固定大小的块，每个块只包含一个进程，如果程序运行需要内存的话，操作系统就分配给他一块，这样会造成资源浪费，会有内存碎片产生。

2，页式管理，把主存分为大小相等切固定一页一页的形式，页较小，相对相比于块式管理划分力度更大，提高了内存利用率，减少了碎片，页式管理通过页表对应逻辑地址和物理地址。

3，段式管理，页式管理中的页并没有任何实际意义，段式管理是把主存分为一段一段的，每一段空间又比一页的空间小得多，但是，段是有实际意义的，每个段定义了一组逻辑信息，段式管理通过段表对应逻辑地址和物理地址。

4，段页式管理，综合了页式管理和段式管理的有点，简单的来说就是把主存分为若干段，每个段又分为若干页，段页式中的段和段之间以及段的内部都是离散的。

### 快表和多级页表

- 快表，用来解决虚拟地址到物理地址转化速度的问题，快表可以看做是一个特殊的高速缓存，其中的内容就是页表或者页表的一部分，没有快表，那么采用页表做地址转化的时候需要访问两次主存，有了快表之后，有时候可以减少一次主存访问，提供指令执行速度。

```
1，根据虚拟地址中的页号查快表
2，如果页在快表中，那么从快表直接读取响应的物理地址。
3，如果不在，那么访问主存中的页表，从页表拿到物理地址，同时页表中的该页的信息也被存到快表中。
4，当快表填满的时候，按照一定的淘汰策略淘汰快表中的一个页
```

- 多级页表，用来避免全部页表一直放在内存中占用过多的空间，特别是根本就不需要的页表就不要保存在内存中，多级页表属于用时间换空间的场景。

### 分页机制和分段机制的共同点和区别

1，共同点：都是为了提高内存利用率，较少内存碎片。页和段都是离散存储的，所以两者都是离散分配内存的方式，但是每个页和段的内存是连续。

2，区别：页的大小是固定的，由操作系统决定，而段的大小不固定，取决于我们当前运行的程序。分页仅仅是满足操作系统内存管理的需求，而段确实逻辑信息的单位，在程序中可以提现出数据段，代码段。

### 逻辑地址和虚拟地址

逻辑地址是由操作系统决定的，不是内存正在的地址，比如存在指针里的值就是逻辑地址。物理地址是指存在真实物理内存中的地址，跟具体一点的是存储在内存地址寄存器中间地址。

### CPU寻址，为什么需要虚拟地址空间

现代处理器使用的是一种称为虚拟寻址的寻址方式，使用虚拟寻址，CPU需要将虚拟地址转化为物理地址，才能真正访问到物理内存，实际上完成虚拟地址到物理地址的转化的是CPU中的MMU即内存管理单元的硬件来实现的。

如果没虚拟地址空间，那么意味着程序都是直接访问物理内存，那么用户程序可以访问任意内存，寻址内存的每一个字节，这样就很容易破坏操作系统，造成崩溃。另外想要同时运行多个程序会比较困难，因为两个同时运行的程序可能会访问到同一个物理内存。

使用了虚拟地址空间，那么程序可以使用一系列相邻的虚拟地址来访问物理内存中不相邻的大内存缓冲区。可以使用一系列虚拟地址来访问大于可用物理内存的内存缓冲区，当物理内存的供应量变小的时候，内存管理器可以将物理内存也保存到磁盘文件，数据和代码页会根据需要在物理内存和磁盘间移动。

不同进程使用的虚拟地址彼此隔离，一个进程的代码无法更改正在由另一个进程访问和使用的物理内存。

### 页面置换算法

当发生缺页中断的时候，如果当前内存没有空闲的页面，那么操作系统会将内存中选择一个页面将其移除内存，然后调入页面。

- OPT页面置换算法 最佳页面置换算法，所选择的页面将是以后永远不会使用的，或者是最长时间不会被访问的页面，这样就能保证获得最低的缺页率，但是这个算法是无法实现的。
- FIFO，先进先出。总是淘汰最先进入内存的页面
- LRU，给每一个页面增加一个字段，来记录页面自上次被访问以来经历的时间T，当淘汰一个页面的时候，选择T最大的，即最近最久未使用的页面。
- LFU，最少使用页面置换算法，选择使用最少的页面作为淘汰的页面。